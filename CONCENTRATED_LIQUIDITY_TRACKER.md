# Concentrated Liquidity Tracker

## Описание

Служебное средство для отслеживания токенов с концентрированной ликвидностью (>50% у одного держателя). Цель - найти возможности безопасного входа/выхода и способы переиграть манипуляторов.

## Как работает

1. **Автоматическое обнаружение**: Когда токен отклоняется фильтрами из-за концентрированной ликвидности, автоматически запускается отслеживание
2. **Мониторинг**: Трекер собирает снимки каждые 30 секунд:
   - Цена токена
   - Ликвидность
   - Количество holders
   - Процент топ-держателя
3. **Анализ возможностей**:
   - **Вход**: Цена упала >20% от пика, ликвидность увеличилась >10%
   - **Выход**: Цена выросла >50%, ликвидность резко уменьшилась >30%
4. **Детальное логирование**: Все данные сохраняются в `logs/concentrated-liquidity/`

## Структура логов

### Файлы для каждого токена:
- `{mint}.jsonl` - Снимки состояния (каждые 30 секунд)
- `{mint}.events.jsonl` - События (вход/выход возможности)
- `{mint}.report.json` - Финальный отчет после завершения отслеживания

### Формат снимка:
```json
{
  "timestamp": "2025-12-30T12:00:00.000Z",
  "mint": "TokenMint...",
  "snapshot": {
    "timestamp": 1735560000000,
    "price": 0.000123456,
    "liquidity": 1500.50,
    "holders": 25,
    "topHolderPct": 65.2
  },
  "stats": {
    "peakPrice": 0.000200000,
    "lowestPrice": 0.000100000,
    "maxLiquidity": 2000.00,
    "minLiquidity": 1000.00,
    "entryOpportunities": 3,
    "exitOpportunities": 1
  }
}
```

### Формат события:
```json
{
  "timestamp": "2025-12-30T12:00:00.000Z",
  "mint": "TokenMint...",
  "eventType": "ENTRY_OPPORTUNITY",
  "data": {
    "price": 0.000150000,
    "priceFromPeak": -25.0,
    "liquidity": 1800.00,
    "reason": "Price drop from peak"
  }
}
```

## Параметры отслеживания

- **Длительность**: 24 часа с момента обнаружения
- **Интервал снимков**: 30 секунд
- **Интервал проверки цены**: 10 секунд
- **Минимальное падение для входа**: 20% от пика
- **Минимальный рост для выхода**: 50% от начальной цены
- **Порог изменения ликвидности**: ±10% для входа, -30% для выхода

## Анализ данных

### Детекция фаз манипуляции:

Трекер автоматически определяет 4 фазы:

1. **ACCUMULATION (Накопление)** - БЕЗОПАСНЫЙ ВХОД
   - Цена стабильна/растет медленно (-10% до +30%)
   - Ликвидность увеличивается (>10%)
   - Safety Score: 0.8-0.95 (зависит от ликвидности)
   - **Лучший момент для входа!**

2. **PUMP (Накачка)** - РИСКОВАННО, но прибыльно
   - Цена быстро растет (>30%)
   - Ликвидность стабильна или растет
   - Safety Score: 0.3
   - Exit Urgency: 0.6 (можно выйти с прибылью)

3. **DUMP (Сброс)** - ОЧЕНЬ РИСКОВАННО
   - Цена падает (>20%)
   - Ликвидность уменьшается (>10%)
   - Safety Score: 0.1
   - Exit Urgency: 0.9 (срочно выходить!)

4. **RECOVERY (Восстановление)** - ОТНОСИТЕЛЬНО БЕЗОПАСНО
   - Цена стабилизируется после падения
   - Ликвидность стабильна
   - Safety Score: 0.6
   - Может быть окном для входа

### Что искать:

1. **Паттерны манипуляций**:
   - Резкое увеличение ликвидности перед ростом цены
   - Резкое уменьшение ликвидности после роста цены
   - Циклы накачки/сброса
   - Временные интервалы между фазами

2. **Безопасные окна входа**:
   - Фаза ACCUMULATION (safety score >0.8)
   - Цена упала от пика, но ликвидность стабильна
   - Манипулятор добавляет ликвидность (готовится к накачке)
   - Низкий ожидаемый slippage (<10%)

3. **Сигналы выхода**:
   - Фаза DUMP (urgency >0.9) - срочно выходить!
   - Ликвидность резко падает (манипулятор выводит)
   - Цена достигла хорошего multiplier (>2x)
   - Фаза PUMP с хорошей прибылью

## Использование

Трекер работает автоматически. Все токены с концентрированной ликвидностью автоматически начинают отслеживаться.

Для просмотра данных:
```bash
# Просмотр снимков токена
cat logs/concentrated-liquidity/{mint}.jsonl | jq

# Просмотр событий
cat logs/concentrated-liquidity/{mint}.events.jsonl | jq

# Просмотр финального отчета
cat logs/concentrated-liquidity/{mint}.report.json | jq
```

## Метрики для анализа

- **peakPrice / lowestPrice**: Диапазон цен
- **maxLiquidity / minLiquidity**: Диапазон ликвидности
- **entryOpportunities**: Количество обнаруженных возможностей входа (с safety score)
- **exitOpportunities**: Количество обнаруженных возможностей выхода (с urgency)
- **estimatedSlippage**: Ожидаемый slippage при входе/выходе (на основе ликвидности)
- **manipulationPhases**: История фаз манипуляции
- **phaseHistory**: Временные интервалы каждой фазы
- **priceVelocity / liquidityVelocity**: Скорость изменения цены/ликвидности
- **totalReturn**: Общий возврат за период отслеживания

## Новые возможности

### Safety Score (0-1) для входа:
- **0.9-1.0**: Очень безопасно (ACCUMULATION с высокой ликвидностью)
- **0.7-0.9**: Безопасно (ACCUMULATION, RECOVERY)
- **0.5-0.7**: Умеренный риск
- **0.3-0.5**: Рискованно (PUMP)
- **0.0-0.3**: Очень рискованно (DUMP)

### Exit Urgency (0-1):
- **0.9-1.0**: Срочно выходить! (DUMP, ликвидность падает)
- **0.6-0.9**: Рекомендуется выйти (PUMP с хорошей прибылью)
- **0.3-0.6**: Можно подождать
- **0.0-0.3**: Не срочно

### Ожидаемый Slippage:
Рассчитывается на основе ликвидности:
- Высокая ликвидность ($5000+) → низкий slippage (5-10%)
- Средняя ликвидность ($2000-5000) → умеренный slippage (10-15%)
- Низкая ликвидность ($1000-2000) → высокий slippage (15-25%)

## Цель

Найти паттерны поведения манипуляторов и определить безопасные моменты для входа/выхода, чтобы переиграть их стратегию.

